var $jscomp={scope:{},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Number.EPSILON",function(a){return Math.pow(2,-52)},"es6-impl","es3");$jscomp.polyfill("Math.sign",function(a){return a?a:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");var Component=function(){};Component.prototype.Start=function(a){};Component.prototype.OnLevelLoaded=function(){};Component.prototype.Update=function(a){};Component.prototype.LateUpdate=function(a){};Component.prototype.OnCollision=function(a){};Component.prototype.OnTrigger=function(a){};
Component.prototype.OnDestroy=function(){};Component.prototype.FirstUpdate=function(){};Component.prototype.GetComponent=function(a){return this.gameObject.GetComponent(a)};var Animation=function(){Component.call(this);this.timePerFrame=1;this._states={};this._currentState=void 0;this._currentSpriteIndex=this._timeToNextFrame=0;this._playingOnce=!1};$jscomp.inherits(Animation,Component);
Animation.prototype.Start=function(a){if(!("states"in a)||0>=a.states.length)console.error("There is an object with an Animation component which doesn't have any sprites."),engine.GameObjects.Destroy(this.gameObject);else{for(var b in a.states){this._states[b]=[];for(var c=0;c<a.states[b].length;c++)this._states[b][c]=new Image,this._states[b][c].src=a.states[b][c]}"timePerFrame"in a&&(this.timePerFrame=a.timePerFrame);"state"in a&&this.Play(a.state);this._timeToNextFrame=this.timePerFrame;void 0!=
this._currentState&&(this.GetComponent("SpriteRenderer").sprite=this._states[this._currentState][0])}};Animation.prototype.Update=function(a){if(void 0!=this._currentState&&(this._timeToNextFrame-=a,0>=this._timeToNextFrame)){this._timeToNextFrame=this.timePerFrame;this._currentSpriteIndex++;if(this._currentSpriteIndex>=this._states[this._currentState].length){if(this._playingOnce){this.Stop();this._playingOnce=!1;return}this._currentSpriteIndex=0}this.GetComponent("SpriteRenderer").sprite=this._states[this._currentState][this._currentSpriteIndex]}};
Animation.prototype.Play=function(a){return void 0!=this._states[a]?(this._currentState=a,this._currentSpriteIndex=0,this._timeToNextFrame=this.timePerFrame,this.GetComponent("SpriteRenderer").sprite=this._states[this._currentState][0],!0):!1};Animation.prototype.Stop=function(){this._currentState=void 0};Animation.prototype.PlayOnce=function(a){this.Play(a)&&(this._playingOnce=!0)};$jscomp.global.Object.defineProperties(Animation.prototype,{currentState:{configurable:!0,enumerable:!0,get:function(){return this._currentState}}});
var BoxCollider=function(){Component.call(this);this.e=this.height=this.width=1;this.isTrigger=!1;this.layer=0};$jscomp.inherits(BoxCollider,Component);BoxCollider.prototype.Start=function(a){engine.Physics.$AddCollider(this);null!=a&&("width"in a&&(this.width=a.width),"height"in a&&(this.height=a.height),"e"in a&&(this.e=a.e),"isTrigger"in a&&(this.isTrigger=a.isTrigger),"layer"in a&&(this.layer=a.layer))};BoxCollider.prototype.OnDestroy=function(){engine.Physics.$RemoveCollider(this)};
var CircleCollider=function(){Component.call(this);this.e=this.radius=1;this.roughness=0;this.isTrigger=this.rollOnCollision=!1;this.layer=0};$jscomp.inherits(CircleCollider,Component);
CircleCollider.prototype.Start=function(a){engine.Physics.$AddCollider(this);null!=a&&("e"in a&&(this.e=a.e),"radius"in a&&(this.radius=a.radius),"roughness"in a&&(this.roughness=a.roughness),"rollOnCollision"in a&&(this.rollOnCollision=a.rollOnCollision),"isTrigger"in a&&(this.isTrigger=a.isTrigger),"layer"in a&&(this.layer=a.layer))};CircleCollider.prototype.OnDestroy=function(){engine.Physics.$RemoveCollider(this)};
var MovingElement=function(){Component.call(this);this._forces=[];this._oldVelocity=Vector.zero;this.mass=this.gravityScale=1;this.fixed=!1;this.velocity=Vector.zero;this.angularVelocity=0;this.interactable=!0;this.collisionVelocity=Vector.zero};$jscomp.inherits(MovingElement,Component);
MovingElement.prototype.Start=function(a){null!=a&&("mass"in a&&(this.mass=a.mass),"velocity"in a&&(this.velocity=new Vector(a.velocity.x,a.velocity.y)),"angularVelocity"in a&&(this.angularVelocity=a.angularVelocity),"gravityScale"in a&&(this.gravityScale=a.gravityScale),"fixed"in a&&(this.fixed=a.fixed),"interactable"in a&&(this.interactable=a.interactable))};
MovingElement.prototype.LateUpdate=function(a){if(this.interactable)if(this.fixed)this._forces=[];else{for(var b=new Vector(0,0),c=0;c<this._forces.length;c++)b=Vector.Add(b,this._forces[c]);b=Vector.Multiply(b,1/this.mass);this._forces=[];1e-7>Vector.Subtract(this._oldVelocity,this.velocity).magnitudeSqr?this.velocity=this.collisionVelocity:this.collisionVelocity=this.velocity;b=Vector.Add(b,Vector.Multiply(engine.Physics.gravity,this.gravityScale));this.GetComponent("Transform").position.x+=this.velocity.x*
a+.5*b.x*a*a;this.GetComponent("Transform").position.y+=this.velocity.y*a+.5*b.y*a*a;this.velocity.x+=b.x*a;this.velocity.y+=b.y*a;Math.abs(this.angularVelocity*a)>Number.EPSILON&&(this.GetComponent("Transform").rotation+=this.angularVelocity*a);this._oldVelocity.x=this.velocity.x;this._oldVelocity.y=this.velocity.y}};MovingElement.prototype.OnCollision=function(a){this.collisionVelocity=a.resultingVelocity};MovingElement.prototype.AddForce=function(a){Vector.IsVector(a)?this._forces.push(a):console.error("Tried to add a force that is not a vector")};
var NetworkController=function(){Component.call(this);this._toSync={};this.networkId=null;this.toUpdate=void 0};$jscomp.inherits(NetworkController,Component);NetworkController.prototype.Start=function(a){if("letsthis._toSync"in a)for(var b in a.letsthis._toSync){this._toSync[b]={};for(var c=0;c<a.letsthis._toSync[b].length;c++){var d=a.letsthis._toSync[b][c],e=this.GetComponent(b)[d];this._toSync[b][d]=new Vector(e.x,e.y)}}};
NetworkController.prototype.Update=function(){this.toUpdate=void 0;for(var a in this._toSync)for(var b in this._toSync[a]){var c=this.GetComponent(a)[b];if(Vector.IsVector(c)){if(c.x!=this._toSync[a][b].x||c.y!=this._toSync[a][b].y)void 0==this.toUpdate&&(this.toUpdate={}),void 0==this.toUpdate[a]&&(this.toUpdate[a]={}),this.toUpdate[a][b]={},this.toUpdate[a][b].x=c.x,this.toUpdate[a][b].y=c.y,this._toSync[a][b]=new Vector(c.x,c.y)}else c!=this._toSync[a][b]&&(void 0==this.toUpdate&&(this.toUpdate=
{}),void 0==this.toUpdate[a]&&(this.toUpdate[a]={}),this.toUpdate[a][b]=c,this._toSync[a][b]=c)}void 0!=this.toUpdate&&(this.toUpdate.networkId=this.networkId)};var NetworkView=function(){Component.call(this);this.networkId=null;this.updated=void 0};$jscomp.inherits(NetworkView,Component);NetworkView.prototype.Start=function(a){this.networkId=a.networkId};
NetworkView.prototype.Update=function(){if(void 0!=this.updated){for(var a in this.updated)for(var b in this.updated[a])void 0!=this.GetComponent(a)[b].x?(this.GetComponent(a)[b].x=this.updated[a][b].x,this.GetComponent(a)[b].y=this.updated[a][b].y):this.GetComponent(a)[b]=this.updated[a][b];this.updated=void 0}};var SpriteRenderer=function(){Component.call(this);this._layer=0;this.sprite=new Image;this.height=this.width=1};$jscomp.inherits(SpriteRenderer,Component);
SpriteRenderer.prototype.Start=function(a){engine.Renderer.$AddRenderer(this);null!=a&&("width"in a&&(this.width=a.width),"height"in a&&(this.height=a.height),"sprite"in a&&(this.sprite.src=a.sprite),"layer"in a&&(this._layer=a.layer))};SpriteRenderer.prototype.OnDestroy=function(){engine.Renderer.$RemoveRenderer(this)};
$jscomp.global.Object.defineProperties(SpriteRenderer.prototype,{layer:{configurable:!0,enumerable:!0,get:function(){return this._layer},set:function(a){this._layer=a;engine.Renderer.$layerChanged=!0}}});var Transform=function(){Component.call(this);this.name="";this.tags=[];this._localPosition=Vector.zero;this._localRotation=0;this._parent=null;this._children=[]};$jscomp.inherits(Transform,Component);
Transform.prototype.Start=function(a){null!=a&&("name"in a&&(this.name=a.name),"rotation"in a&&(this._localRotation=a.rotation),"tags"in a&&Array.isArray(a.tags)&&(this.tags=a.tags),"position"in a&&(this._localPosition=new Vector(a.position.x,a.position.y)))};Transform.prototype.$AddChild=function(a){this._children.push(a)};Transform.prototype.$RemoveChild=function(a){this._children.splice(this._children.indexOf(a),1)};
Transform.prototype.OnDestroy=function(){this._children.forEach(function(a){engine.GameObjects.Destroy(a.gameObject)});null!=this._parent&&(this._parent.$RemoveChild(this.gameObject),this._parent=void 0)};
$jscomp.global.Object.defineProperties(Transform.prototype,{position:{configurable:!0,enumerable:!0,get:function(){return null!=this._parent?Vector.Add(this._parent.position,this._localPosition):this._localPosition},set:function(a){0==Vector.IsVector(a)?console.error("A position has to be a Vector."):this._localPosition=null!=this._parent?Vector.Subtract(a,this._parent.position):a}},localPosition:{configurable:!0,enumerable:!0,get:function(){return this._localPosition},set:function(a){0==Vector.IsVector(a)?
console.error("A position has to be a Vector."):this._localPosition=a}},rotation:{configurable:!0,enumerable:!0,get:function(){return null!=this._parent?this._parent.rotation+this._localRotation:this._localRotation},set:function(a){this._localRotation=null!=this._parent?a-this._parent.rotation:a}},localRotation:{configurable:!0,enumerable:!0,get:function(){return this._localRotation},set:function(a){this._localRotation=a}},parent:{configurable:!0,enumerable:!0,get:function(){return this._parent},
set:function(a){0==a instanceof Transform&&null!=a?console.error("The parent of a Transform must be another Transform."):(void 0!=this._parent&&this._parent.$RemoveChild(this),this._parent=a,null!=a&&a.$AddChild(this))}},children:{configurable:!0,enumerable:!0,get:function(){return this._children.slice()}}});
var engine,Engine=function(a){void 0!=engine&&console.warn("An engine already exist. Replacing for now.");engine=this;this.Camera=new Camera(a);this.InputManager=new InputManager(a);this.Network=new Network;this.SoundManager=new SoundManager;this.GameObjects=new GameObjects;this.Renderer=new Renderer(a);this.Physics=new Physics;this._canvas=a;this._lastTimestamp=0;this._deltaTime=.02;this._requestAnimationFrameId=window.requestAnimationFrame(this._Update,a)};
Engine.prototype._Update=function(a){0!==engine._lastTimestamp&&(engine._deltaTime=(a-engine._lastTimestamp)/1E3,engine._deltaTime=Math.min(engine._deltaTime,.02));engine._lastTimestamp=a;engine.GameObjects.$Update(engine._deltaTime);engine.Network.$Update();engine.Physics.$Update();engine.Renderer.$Update();engine._requestAnimationFrameId=window.requestAnimationFrame(engine._Update,this._canvas)};
Engine.prototype.LoadLevel=function(a,b){null!=this._requestAnimationFrameId&&cancelAnimationFrame(this._requestAnimationFrameId);document.activeElement.blur();if(1==b)for(b=0;b<a.gameObjects.length;b++)this.Network.Instantiate(a.gameObjects[b]);else for(b=0;b<a.gameObjects.length;b++)this.GameObjects.Instantiate(a.gameObjects[b]);"gravity"in a&&(this.Physics.gravity=new Vector(a.gravity.x,a.gravity.y));this.GameObjects.$OnLevelLoaded();"name"in a&&console.log("Loaded level : '"+a.name+"'");this._requestAnimationFrameId=
window.requestAnimationFrame(this._Update,this._canvas)};var GameObject=function(){this._components=[]};GameObject.prototype.$FirstUpdate=function(a){for(var b in this._components)this._components[b].FirstUpdate(a)};GameObject.prototype.$Update=function(a){for(var b in this._components)this._components[b].Update(a)};GameObject.prototype.$LateUpdate=function(a){for(var b in this._components)this._components[b].LateUpdate(a)};GameObject.prototype.$OnLevelLoaded=function(){for(var a in this._components)this._components[a].OnLevelLoaded()};
GameObject.prototype.$OnCollision=function(a){for(var b in this._components)this._components[b].OnCollision(a)};GameObject.prototype.$OnTrigger=function(a){for(var b in this._components)this._components[b].OnTrigger(a)};GameObject.prototype.$OnDestroy=function(){for(var a in this._components)this._components[a].OnDestroy();for(var b in this._components)this._components[b].gameObject=null,this._components[b]=null,delete this._components[b]};GameObject.prototype.GetComponent=function(a){return this._components[a]};
GameObject.prototype.AddComponent=function(a,b){var c=eval(a);if(void 0!=c&&c.prototype instanceof Component)return this._components[a]=new c,this._components[a].gameObject=this,void 0==b&&(b={}),this._components[a].Start(b),this._components[a];console.error(a+" is not a valid component. Did you forget to add the link to the Component file?")};var Camera=function(a){this.size=10;this.position=Vector.zero;this._screenSize=new Vector(a.width,a.height);this._ratio=a.width/a.height};
Camera.prototype.ScreenToWorldPoint=function(a){return new Vector(a.x/this._screenSize.x*this.size*this._ratio+(this.position.x-this.size*this._ratio/2),a.y/this._screenSize.y*this.size+(this.position.y-this.size/2))};Camera.prototype.WorldToScreenPoint=function(a){return new Vector((a.x-(this.position.x-this.size*this._ratio/2))/(this.size*this._ratio)*this._screenSize.x,(a.y-(this.position.y-this.size/2))/this.size*this._screenSize.y)};
Camera.prototype.WorldToScreenLengthX=function(a){return a/(this.size*this._ratio)*this._screenSize.x};Camera.prototype.WorldToScreenLengthY=function(a){return a/this.size*this._screenSize.y};var GameObjects=function(){this._gameObjects=[];this._firstUpdateToCall=[]};
GameObjects.prototype.$Update=function(a){for(var b=0;b<this._firstUpdateToCall.length;b++)this._firstUpdateToCall[b].$FirstUpdate(a);this._firstUpdateToCall=[];for(b=0;b<this._gameObjects.length;b++)this._gameObjects[b].$Update(a);for(b=0;b<this._gameObjects.length;b++)this._gameObjects[b].$LateUpdate(a)};GameObjects.prototype.$OnLevelLoaded=function(){for(var a=0;a<this._gameObjects.length;a++)this._gameObjects[a].$OnLevelLoaded()};
GameObjects.prototype.$DeleteAll=function(){for(var a=0;a<this._gameObjects.length;a++)this.Destroy(this._gameObjects[a]);this._gameObjects=[]};GameObjects.prototype.Instantiate=function(a){var b=new GameObject;this._gameObjects[this._gameObjects.length]=b;for(var c in a)b.AddComponent(c,a[c]);this._firstUpdateToCall.push(b);return this._gameObjects[this._gameObjects.length-1]};
GameObjects.prototype.Destroy=function(a){0>this._gameObjects.indexOf(a)?console.error("You are trying to destroy a GameObject that is not in the engine's GameObjects list."):(a.$OnDestroy(),this._gameObjects.splice(this._gameObjects.indexOf(a),1))};GameObjects.prototype.GetGameObjects=function(){return this._gameObjects.slice()};
GameObjects.prototype.FindGameObjectsWithTag=function(a){for(var b=[],c=0;c<this._gameObjects.length;c++)void 0!=this._gameObjects[c].GetComponent("Transform")&&-1!=this._gameObjects[c].GetComponent("Transform").tags.indexOf(a)&&b.push(this._gameObjects[c]);return b};
GameObjects.prototype.FindGameObjectWithName=function(a){for(var b=0;b<this._gameObjects.length;b++)if(void 0!=this._gameObjects[b].GetComponent("Transform")&&this._gameObjects[b].GetComponent("Transform").name==a)return this._gameObjects[b];return null};GameObjects.prototype.FindGameObjectsWithComponent=function(a){for(var b=[],c=0;c<this._gameObjects.length;c++)void 0!=this._gameObjects[c].GetComponent(a)&&b.push(this._gameObjects[c]);return b};
var InputManager=function(a){this.keysPressed=[];this.mouse={isDown:!1,position:Vector.zero};this._canvas=a;document.addEventListener("keydown",function(a){engine.InputManager.keysPressed[a.keyCode]=!0});document.addEventListener("keyup",function(a){engine.InputManager.keysPressed[a.keyCode]=!1});a.addEventListener("mousemove",function(b){var c=a.getBoundingClientRect();engine.InputManager.mouse.position=engine.Camera.ScreenToWorldPoint({x:a.width/a.scrollWidth*(b.clientX-c.left),y:a.height-a.height/
a.scrollHeight*(b.clientY-c.top)})});a.addEventListener("mousedown",function(a){engine.InputManager.mouse.isDown=!0});document.addEventListener("mouseup",function(a){engine.InputManager.mouse.isDown=!1})},Network=function(){this._maxGOsPerMessage=200;this._websocket=null;this._currentRoomId=this._tmpRoomId=0;this._networkControllersToSync=[];this._remoteNetworkViews={};this._getRoomListCallbacks=[];this._connectCallback=this._joinRoomCallback=this._leaveRoomCallback=this._createRoomCallback=void 0;
this._gosToCreate=[];this._gosInCreation=[];this._idsToDestroy=[]};Network.prototype.Connect=function(a,b,c){null!=this._websocket&&this.Disconnect();"function"===typeof c&&(connectCallback=c);this._websocket=new WebSocket("ws://"+a+":"+b);this._websocket.onopen=this._onopen;this._websocket.onclose=this._onclose;this._websocket.onmessage=this._onmessage;this._websocket.onerror=this._onerror};Network.prototype.GetRoomsList=function(a){"function"===typeof a&&this._getRoomListCallbacks.push(a);this._websocket.send(JSON.stringify({command:"getRoomsList"}))};
Network.prototype.CreateRoom=function(a,b){a={command:"createRoom",name:a};"function"===typeof b&&(this._createRoomCallback=b);this._websocket.send(JSON.stringify(a))};
Network.prototype.LeaveRoom=function(a){for(var b=this._currentRoomId=0;b<this._networkControllersToSync.length;b++)engine.GameObjects.Destroy(this._networkControllersToSync[b].gameObject);networkControllersToSync=[];for(var c in this._remoteNetworkViews)engine.GameObjects.Destroy(this._remoteNetworkViews[c].gameObject);this._remoteNetworkViews={};"function"===typeof a&&(this._leaveRoomCallback=a);this._websocket.send(JSON.stringify({command:"leaveRoom"}))};
Network.prototype.JoinRoom=function(a,b){"function"===typeof b&&(this._joinRoomCallback=b);this._tmpRoomId=a;this._websocket.send(JSON.stringify({command:"joinRoom",roomId:a}))};
Network.prototype.Disconnect=function(){for(var a=this._currentRoomId=0;a<this._networkControllersToSync.length;a++)engine.GameObjects.Destroy(this._networkControllersToSync[a].gameObject);networkControllersToSync=[];for(var b in this._remoteNetworkViews)engine.GameObjects.Destroy(this._remoteNetworkViews[b].gameObject);this._remoteNetworkViews={};null!=this._websocket&&this._websocket.close()};
Network.prototype.Instantiate=function(a){var b=engine.GameObjects.Instantiate(a);if(0==this._currentRoomId)return console.error("You can't instantiate a networked GameObject if you are not in a room."),b;if(void 0==b.GetComponent("NetworkController"))return console.error("Trying to networkly instantiate a GameObject with no NetworkController"),b;this._networkControllersToSync.push(b.GetComponent("NetworkController"));this._gosInCreation.push(b);this._gosToCreate.push(a);return b};
Network.prototype.Destroy=function(a){var b=a.GetComponent("NetworkController");void 0==b?console.error("Can't destroy a non-networked GameObject with engine.Network.Destroy() or a GameObject of another client."):(this._networkControllersToSync.splice(this._networkControllersToSync.indexOf(b),1),this._idsToDestroy.push(b.networkId),engine.GameObjects.Destroy(a))};
Network.prototype.$Update=function(){if(null!=this._websocket&&1==this._websocket.readyState&&0!=this._currentRoomId){0<this._idsToDestroy.length&&(this._websocket.send(JSON.stringify({command:"destroyGO",ids:this._idsToDestroy})),this._idsToDestroy=[]);if(0<this._gosToCreate.length)for(;0<this._gosToCreate.length;){for(var a=[],b=0;b<this._gosToCreate.length&&b<this._maxGOsPerMessage;b++)a.push(this._gosToCreate[b]);this._websocket.send(JSON.stringify({command:"createGO",gameObjects:a}));this._gosToCreate.splice(0,
a.length)}a=[];for(b=0;b<this._networkControllersToSync.length;b++)null!=this._networkControllersToSync[b].toUpdate&&(a.push(this._networkControllersToSync[b].toUpdate),this._networkControllersToSync[b].toUpdate=void 0);0<a.length&&this._websocket.send(JSON.stringify({command:"updateGO",gameObjects:a}))}};Network.prototype._onopen=function(a){void 0!=this._connectCallback&&(this._connectCallback(),this._connectCallback=void 0)};Network.prototype._onclose=function(a){};
Network.prototype._onmessage=function(a){a=JSON.parse(a.data);switch(a.command){case "roomCreated":for(var b=0;b<engine.Network._networkControllersToSync.length;b++)engine.GameObjects.Destroy(engine.Networkthis._networkControllersToSync[b].gameObject);engine.Network._networkControllersToSync=[];for(var c in engine.Network._remoteNetworkViews)engine.GameObjects.Destroy(engine.Network._remoteNetworkViews[c].gameObject);engine.Network._remoteNetworkViews={};engine.Network._currentRoomId=a.id;void 0!=
engine.Network._createRoomCallback&&(engine.Network._createRoomCallback(engine.Network._currentRoomId),engine.Network._createRoomCallback=void 0);break;case "roomJoined":for(a=0;a<engine.Network._networkControllersToSync.length;a++)engine.GameObjects.Destroy(engine.Network._networkControllersToSync[a].gameObject);engine.Network._networkControllersToSync=[];for(b in engine.Network._remoteNetworkViews)engine.GameObjectsDestroy(engine.Network._remoteNetworkViews[b].gameObject);engine.Network._remoteNetworkViews=
{};engine.Network._currentRoomId=engine.Network._tmpRoomId;engine.Network._tmpRoomId=0;break;case "roomLoaded":void 0!=engine.Network._joinRoomCallback&&(engine.Network._joinRoomCallback(),engine.Network._joinRoomCallback=void 0);break;case "roomLeft":void 0!=engine.Network._leaveRoomCallback&&(engine.Network._leaveRoomCallback(),engine.Network._leaveRoomCallback=void 0);break;case "GOCreated":for(c=0;c<a.ids.length;c++)engine.Network._gosInCreation[0].GetComponent("NetworkController").networkId=
a.ids[c],engine.Network._gosInCreation.splice(0,1);break;case "createGO":for(c=0;c<a.gameObjects.length;c++)engine.Network._CreateRemoteGO(a.gameObjects[c]);break;case "updateGO":for(c=0;c<a.gameObjects.length;c++)b=a.gameObjects[c].networkId,delete a.gameObjects[c].networkId,engine.Network._remoteNetworkViews[b].updated=a.gameObjects[c];break;case "destroyGO":for(c=0;c<a.ids.length;c++)engine.GameObjects.Destroy(engine.Network._remoteNetworkViews[a.ids[c]].gameObject),delete engine.Network._remoteNetworkViews[a.ids[c]];
break;case "roomsList":for(c=0;c<engine.Network._getRoomListCallbacks.length;c++)engine.Network._getRoomListCallbacks[c](a.rooms);engine.Network._getRoomListCallbacks=[]}};Network.prototype._onerror=function(a){};Network.prototype._CreateRemoteGO=function(a){var b=a.networkId;delete a.networkId;delete a.NetworkController;a.NetworkView={networkId:b};a=engine.GameObjects.Instantiate(a);this._remoteNetworkViews[b]=a.GetComponent("NetworkView")};
var Physics=function(){this._colliders={circles:[],boxes:[]};this.gravity=new Vector(0,-9.8)};Physics.prototype.$Update=function(a){this._ResolveCollisions()};Physics.prototype.$AddCollider=function(a){a instanceof CircleCollider?this._colliders.circles.push(a):a instanceof BoxCollider?this._colliders.boxes.push(a):console.error("AddCollider -- The provided component is not a known component.")};
Physics.prototype.$RemoveCollider=function(a){a instanceof CircleCollider?this._colliders.circles.splice(this._colliders.circles.indexOf(a),1):a instanceof BoxCollider?this._colliders.boxes.splice(this._colliders.boxes.indexOf(a),1):console.error("RemoveCollider -- The provided component is not a known component.")};
Physics.prototype._ResolveCollisions=function(){for(var a=0;a<this._colliders.circles.length;a++){for(var b=a+1;b<this._colliders.circles.length;b++)0!=this._colliders.circles[a].layer&&0!=this._colliders.circles[b].layer&&this._colliders.circles[a].layer==this._colliders.circles[b].layer||this._CircleCircle(this._colliders.circles[a],this._colliders.circles[b]);for(b=0;b<this._colliders.boxes.length;b++)0!=this._colliders.circles[a].layer&&0!=this._colliders.boxes[b].layer&&this._colliders.circles[a].layer==
this._colliders.boxes[b].layer||this._CircleBox(this._colliders.circles[a],this._colliders.boxes[b])}for(a=0;a<this._colliders.boxes.length;a++)for(b=a+1;b<this._colliders.boxes.length;b++)0!=this._colliders.boxes[a].layer&&0!=this._colliders.boxes[b].layer&&this._colliders.boxes[a].layer==this._colliders.boxes[b].layer||this._BoxBox(this._colliders.boxes[a],this._colliders.boxes[b])};
Physics.prototype._CircleCircle=function(a,b){if(!a.GetComponent("MovingElement").fixed||!b.GetComponent("MovingElement").fixed){var c=a.radius+b.radius,d=c*c,e=(a.GetComponent("Transform").position.x-b.GetComponent("Transform").position.x)*(a.GetComponent("Transform").position.x-b.GetComponent("Transform").position.x)+(a.GetComponent("Transform").position.y-b.GetComponent("Transform").position.y)*(a.GetComponent("Transform").position.y-b.GetComponent("Transform").position.y);if(e<d)if(a.isTrigger||
b.isTrigger)d={collider:a},a.gameObject.$OnTrigger({collider:b}),b.gameObject.$OnTrigger(d);else{var h=a.GetComponent("MovingElement").mass,f=b.GetComponent("MovingElement").mass,d=a.GetComponent("MovingElement").collisionVelocity,g=b.GetComponent("MovingElement").collisionVelocity,k=Math.min(a.e,b.e),m=(k*h*(d.x-g.x)+h*d.x+f*g.x)/(h+f),l=(k*h*(d.y-g.y)+h*d.y+f*g.y)/(h+f),h=(new Vector((k*f*(g.x-d.x)+h*d.x+f*g.x)/(h+f),(k*f*(g.y-d.y)+h*d.y+f*g.y)/(h+f))).magnitude,m=(new Vector(m,l)).magnitude,l=
Math.sqrt(e),e=new Vector(a.GetComponent("Transform").position.x-b.GetComponent("Transform").position.x,a.GetComponent("Transform").position.y-b.GetComponent("Transform").position.y),f=e.normalized;a.GetComponent("MovingElement").fixed?b.GetComponent("MovingElement").fixed||(b.GetComponent("Transform").position.x+=(c-l)*-f.x,b.GetComponent("Transform").position.y+=(c-l)*-f.y):(a.GetComponent("Transform").position.x+=(c-l)*f.x,a.GetComponent("Transform").position.y+=(c-l)*f.y);l=new Vector(e.y,-e.x);
c=Vector.Multiply(this._CalculateAngleCircleCircle(Vector.Subtract(d,g),l),h);l=new Vector(-e.y,e.x);d=Vector.Multiply(this._CalculateAngleCircleCircle(Vector.Subtract(g,d),l),m);d={collider:a,resultingVelocity:d};a.gameObject.$OnCollision({collider:b,resultingVelocity:c});b.gameObject.$OnCollision(d)}}};
Physics.prototype._BoxBox=function(a,b){var c=a.GetComponent("Transform").position,d=b.GetComponent("Transform").position,e=c.x-a.width/2,h=c.y-a.height/2,f=a.width,g=a.height,k=d.x-b.width/2,m=d.y-b.height/2,l=b.height;e<k+b.width&&e+f>k&&h<m+l&&g+h>m&&(a.isTrigger||b.isTrigger?(c={collider:a},a.gameObject.$OnTrigger({collider:b}),b.gameObject.$OnTrigger(c)):(f=a.GetComponent("MovingElement").collisionVelocity,e=b.GetComponent("MovingElement").collisionVelocity,h=Math.min(a.e,b.e),g=a.width/2+b.width/
2-Math.abs(c.x-d.x),k=a.height/2+b.height/2-Math.abs(c.y-d.y),g<k?(a.GetComponent("MovingElement").fixed?b.GetComponent("Transform").position.x+=g*Math.sign(d.x-c.x):b.GetComponent("MovingElement").fixed?a.GetComponent("Transform").position.x+=g*Math.sign(c.x-d.x):(a.GetComponent("Transform").position.x+=g/2*Math.sign(c.x-d.x),b.GetComponent("Transform").position.x+=g/2*Math.sign(d.x-c.x)),c=new Vector(-f.x*h,f.y),d=new Vector(-e.x*h,e.y)):(a.GetComponent("MovingElement").fixed?b.GetComponent("Transform").position.y+=
k*Math.sign(d.y-c.y):b.GetComponent("MovingElement").fixed?a.GetComponent("Transform").position.y+=k*Math.sign(c.y-d.y):(a.GetComponent("Transform").position.y+=k/2*Math.sign(c.y-d.y),b.GetComponent("Transform").position.y+=k/2*Math.sign(d.y-c.y)),c=new Vector(f.x,-f.y*h),d=new Vector(e.x,-e.y*h)),d={collider:a,resultingVelocity:d},a.gameObject.$OnCollision({collider:b,resultingVelocity:c}),b.gameObject.$OnCollision(d)))};
Physics.prototype._CircleBox=function(a,b){var c=Vector.Subtract(a.GetComponent("Transform").position,b.GetComponent("Transform").position),d=b.width/2+a.radius-Math.abs(c.x),e=b.height/2+a.radius-Math.abs(c.y);if(0<d&&0<e)if(b.isTrigger||a.isTrigger)d={collider:a},a.gameObject.$OnTrigger({collider:b}),b.gameObject.$OnTrigger(d);else{var c=Math.min(a.e,b.e),h=a.GetComponent("MovingElement").collisionVelocity,f=b.GetComponent("MovingElement").collisionVelocity,g=a.GetComponent("Transform").position,
k=a.GetComponent("Transform").position;d<e?(a.GetComponent("MovingElement").fixed?b.GetComponent("Transform").position.x+=d*Math.sign(k.x-g.x):b.GetComponent("MovingElement").fixed?a.GetComponent("Transform").position.x+=d*Math.sign(g.x-k.x):(a.GetComponent("Transform").position.x+=d/2*Math.sign(g.x-k.x),b.GetComponent("Transform").position.x+=d/2*Math.sign(k.x-g.x)),d=new Vector(-h.x*c,h.y),c=new Vector(-f.x*c,f.y)):(a.GetComponent("MovingElement").fixed?b.GetComponent("Transform").position.y+=e*
Math.sign(k.y-g.y):b.GetComponent("MovingElement").fixed?a.GetComponent("Transform").position.y+=e*Math.sign(g.y-k.y):(a.GetComponent("Transform").position.y+=e/2*Math.sign(g.y-k.y),b.GetComponent("Transform").position.y+=e/2*Math.sign(k.y-g.y)),d=new Vector(h.x,-h.y*c),c=new Vector(f.x,-f.y*c));c={collider:a,resultingVelocity:c};a.gameObject.$OnCollision({collider:b,resultingVelocity:d});b.gameObject.$OnCollision(c)}};
Physics.prototype._CalculateAngleCircleCircle=function(a,b){var c=b.normalized;b=new Vector(b.y,-b.x);c=Vector.Project(c,a);a=Vector.Project(a,b);a=Vector.Multiply(a,-1);return Vector.Add(c,a).normalized};var Renderer=function(a){this.$layerChanged=!0;this._canvas=a;this._ctx=a.getContext("2d");this._renderers=[]};Renderer.prototype.$AddRenderer=function(a){a instanceof SpriteRenderer?(this._renderers.push(a),this.$layerChanged=!0):console.error("AddRenderer -- The provided component is not a known component.")};
Renderer.prototype.$RemoveRenderer=function(a){a instanceof SpriteRenderer?this._renderers.splice(this._renderers.indexOf(a),1):console.error("RemoveRenderer -- The provided component is not a known component.")};Renderer.prototype.$Update=function(){this.$layerChanged&&(this._renderers.sort(this._SortBySpriteLayerId),this.$layerChanged=!1);this._Render()};
Renderer.prototype._Render=function(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height);for(var a=0;a<this._renderers.length;a++){var b=this._renderers[a].gameObject,c=this._renderers[a];if(null!=c&&0!=c.sprite.naturalHeight){var d=b.GetComponent("Transform"),b=engine.Camera.WorldToScreenPoint(d.position),d=d.rotation,e=engine.Camera.WorldToScreenLengthX(c.width),h=engine.Camera.WorldToScreenLengthY(c.height),f=0==Math.sign(c.width)?1:Math.sign(c.width),g=0==Math.sign(c.height)?1:Math.sign(c.height);
this._ctx.translate(b.x,this._canvas.height-b.y);this._ctx.rotate(d);this._ctx.scale(f,g);this._ctx.drawImage(c.sprite,-(e/2)+.5,-(h/2)+.5,e,h);this._ctx.scale(f,g);this._ctx.rotate(-d);this._ctx.translate(-b.x,-(this._canvas.height-b.y))}}};Renderer.prototype._SortBySpriteLayerId=function(a,b){return a.layer-b.layer};var SoundManager=function(){this._audio={}};SoundManager.prototype.Load=function(a,b){this._audio[a]=new Audio(b)};
SoundManager.prototype.Play=function(a){a in this._audios&&(this._audios[a].loop=!1,this._audios[a].play())};SoundManager.prototype.PlayLoop=function(a){a in this._audios&&(this._audios[a].loop=!0,this._audios[a].play())};SoundManager.prototype.Pause=function(a){a in this._audios&&this._audios[a].pause()};SoundManager.prototype.Stop=function(a){a in this._audios&&(this._audios[a].pause(),this._audios[a].currentTime=0)};
SoundManager.prototype.Mute=function(){for(var a in this._audios)this._audios[a].muted=!0};SoundManager.prototype.UnMute=function(){for(var a in this._audios)this._audios[a].muted=!1};var Clamp=function(a,b,c){return Math.min(Math.max(a,b),c)},Vector=function(a,b){this.x=a;this.y=b};Vector.prototype.Clamp=function(a){var b=this.magnitude;b>a&&(a=Vector.Multiply(this,a/b),this.x=a.x,this.y=a.y)};
Vector.DistanceSqr=function(a,b){return a instanceof Vector&&b instanceof Vector?(b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y):(console.error("The arguments are not vectors"),null)};Vector.Distance=function(a,b){return a instanceof Vector&&b instanceof Vector?Math.sqrt(Vector.DistanceSqr(a,b)):(console.error("The arguments are not vectors"),null)};Vector.IsVector=function(a){return a instanceof Vector};
Vector.Add=function(a,b){return a instanceof Vector&&b instanceof Vector?new Vector(a.x+b.x,a.y+b.y):(console.error("The arguments are not vectors"),null)};Vector.Subtract=function(a,b){return a instanceof Vector&&b instanceof Vector?new Vector(a.x-b.x,a.y-b.y):(console.error("The arguments are not vectors"),null)};Vector.Multiply=function(a,b){return a instanceof Vector?new Vector(a.x*b,a.y*b):(console.error("The arguments are not vectors"),null)};
Vector.DotProduct=function(a,b){return a instanceof Vector&&b instanceof Vector?a.x*b.x+a.y*b.y:(console.error("The arguments are not vectors"),null)};Vector.Project=function(a,b){return a instanceof Vector&&b instanceof Vector?Vector.Multiply(b,Vector.DotProduct(a,b)/b.magnitudeSqr):(console.error("The arguments are not vectors"),null)};
$jscomp.global.Object.defineProperties(Vector.prototype,{magnitude:{configurable:!0,enumerable:!0,get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},magnitudeSqr:{configurable:!0,enumerable:!0,get:function(){return this.x*this.x+this.y*this.y}},angle:{configurable:!0,enumerable:!0,get:function(){return 0>this.y?2*Math.PI-Math.acos(this.x/this.magnitude):Math.acos(this.x/this.magnitude)}},normalized:{configurable:!0,enumerable:!0,get:function(){var a=this.magnitude;return 0===a?new Vector(0,
0):Vector.Multiply(this,1/a)}}});$jscomp.global.Object.defineProperties(Vector,{zero:{configurable:!0,enumerable:!0,get:function(){return new Vector(0,0)}}});
